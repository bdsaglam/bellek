schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-kg-llm/create_mhqa_dataset.py --config-file data/raw/musique-kg-llm/train/dataset-config.json
      --out data/generated/musique-kg-llm/train/dataset.jsonl
    deps:
    - path: data/raw/musique-kg-llm/train/dataset-config.json
      hash: md5
      md5: abf3699f51e6c11596b45b45cda1a215
      size: 86
    - path: pipelines/musique-kg-llm/create_mhqa_dataset.py
      hash: md5
      md5: 51842a6b4ab4ee24b652f411d2159958
      size: 343
    outs:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: 27d59420b5286132559d6c5744b2f3ea
      size: 100407
  filter_supporting_paragraphs:
    cmd: python pipelines/musique-kg-llm/filter_supporting_paragraphs.py --dataset-file
      data/generated/musique-kg-llm/train-dataset.jsonl --out data/generated/musique-kg-llm/train-dataset-supporting.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train-dataset.jsonl
      hash: md5
      md5: c0127cd0cfae52d3b1c5461da6ff1a36
      size: 93684
    - path: pipelines/musique-kg-llm/filter_supporting_paragraphs.py
      hash: md5
      md5: 65b4b57754cc919add1f2057ba9e3224
      size: 522
    outs:
    - path: data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      hash: md5
      md5: 7229e21893c3c22e48db5431dcbbe795
      size: 48748
  decompose_question:
    cmd: python pipelines/musique-kg-llm/decompose_question.py --dataset-file data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      --out data/generated/musique-kg-llm/train-dataset-question-decomposition.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      hash: md5
      md5: 7229e21893c3c22e48db5431dcbbe795
      size: 48748
    - path: pipelines/musique-kg-llm/decompose_question.py
      hash: md5
      md5: f7ac90a566c3bad266262a8c3d2f11ba
      size: 1030
    outs:
    - path: data/generated/musique-kg-llm/train-dataset-question-decomposition.jsonl
      hash: md5
      md5: 7ba06760800b1e5b979563a568c7d7c6
      size: 2581
  decompose_questions:
    cmd: python pipelines/musique-kg-llm/decompose_questions.py --dataset-file data/generated/musique-kg-llm/train/dataset.jsonl
      --out data/generated/musique-kg-llm/train/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: 27d59420b5286132559d6c5744b2f3ea
      size: 100407
    - path: pipelines/musique-kg-llm/decompose_questions.py
      hash: md5
      md5: f7ac90a566c3bad266262a8c3d2f11ba
      size: 1030
    outs:
    - path: data/generated/musique-kg-llm/train/question-decomposition.jsonl
      hash: md5
      md5: 458984d586ffa40fb022778100c6d3b2
      size: 2601
  construct_knowledge_graphs:
    cmd: python pipelines/musique-kg-llm/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-kg-llm/train/dataset.jsonl --llm-config-file data/raw/musique-kg-llm/train/erx-llm-configs/llama2-sft.json
      --out data/generated/musique-kg-llm/train/knowledge-graphs/
    deps:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: 27d59420b5286132559d6c5744b2f3ea
      size: 100407
    - path: pipelines/musique-kg-llm/construct_knowledge_graphs.py
      hash: md5
      md5: 2b0e2ae5d3f7924851b2c40d07961274
      size: 7930
    outs:
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/timestamp.txt
      hash: md5
      md5: d5bd3c1e064f799b10c0d6c1d0244c1e
      size: 23
  answer_questions:
    cmd: python pipelines/musique-kg-llm/answer_questions.py --dataset-file data/generated/musique-kg-llm/train/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-kg-llm/train/knowledge-graphs/  --out
      data/generated/musique-kg-llm/train/answers.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/timestamp.txt
      hash: md5
      md5: d5bd3c1e064f799b10c0d6c1d0244c1e
      size: 23
    - path: data/generated/musique-kg-llm/train/question-decomposition.jsonl
      hash: md5
      md5: 458984d586ffa40fb022778100c6d3b2
      size: 2601
    - path: pipelines/musique-kg-llm/answer_questions.py
      hash: md5
      md5: 4c5ed1608fcfebfcf71ffbc7f82f1235
      size: 3531
    outs:
    - path: data/generated/musique-kg-llm/train/answers.jsonl
      hash: md5
      md5: 440ae31186b36cd29d7bbed387c770dc
      size: 3147
  evaluate_answers:
    cmd: python pipelines/musique-kg-llm/evaluate_answers.py --dataset-file data/generated/musique-kg-llm/train/dataset.jsonl
      --answers-file data/generated/musique-kg-llm/train/answers.jsonl --out data/generated/musique-kg-llm/train/answer-eval/
    deps:
    - path: data/generated/musique-kg-llm/train/answers.jsonl
      hash: md5
      md5: 440ae31186b36cd29d7bbed387c770dc
      size: 3147
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: 27d59420b5286132559d6c5744b2f3ea
      size: 100407
    - path: pipelines/musique-kg-llm/evaluate_answers.py
      hash: md5
      md5: 8150bda9d38058fac61e0d59abb38717
      size: 1508
    outs:
    - path: data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl
      hash: md5
      md5: 6cfa5477c2e7c2c5dda029428e368065
      size: 2238
    - path: data/generated/musique-kg-llm/train/answer-eval/scores.json
      hash: md5
      md5: f0ad506b3ee0839a9addf5554e745711
      size: 46
  prepare_erx_reward_dataset:
    cmd: python pipelines/musique-kg-llm/prepare_erx_reward_dataset.py --knowledge-graph-directory
      data/generated/musique-kg-llm/train/knowledge-graphs/ --answer-comparisons-file
      data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl --out data/generated/musique-kg-llm/train/erx-reward-dataset.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl
      hash: md5
      md5: e6a79e6683f8cbae9bed7ce1211ce52d
      size: 2316
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/
      hash: md5
      md5: b08548ef597d7af0c4b9844e559ac86c.dir
      size: 156758182
      nfiles: 151
    - path: pipelines/musique-kg-llm/prepare_erx_reward_dataset.py
      hash: md5
      md5: 4adcee57811974127c972e84621e18f2
      size: 1775
    outs:
    - path: data/generated/musique-kg-llm/train/erx-reward-dataset.jsonl
      hash: md5
      md5: c1ad0b9f7ce9e63652ca7ccf83f9cdd5
      size: 132392
