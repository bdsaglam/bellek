schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-kg-llm/create_mhqa_dataset.py --config-file data/raw/musique-kg-llm/train/dataset-config.json
      --out data/generated/musique-kg-llm/train/dataset.jsonl
    deps:
    - path: data/raw/musique-kg-llm/train/dataset-config.json
      hash: md5
      md5: f3e74a4953be23217b8c177757e4b5f5
      size: 78
    - path: pipelines/musique-kg-llm/create_mhqa_dataset.py
      hash: md5
      md5: c4c17adadc9e5f9df181700f2adf4ca3
      size: 2468
    outs:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: c0820ab95135996039db243bfb9fd53f
      size: 349905
  filter_supporting_paragraphs:
    cmd: python pipelines/musique-kg-llm/filter_supporting_paragraphs.py --dataset-file
      data/generated/musique-kg-llm/train-dataset.jsonl --out data/generated/musique-kg-llm/train-dataset-supporting.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train-dataset.jsonl
      hash: md5
      md5: c0127cd0cfae52d3b1c5461da6ff1a36
      size: 93684
    - path: pipelines/musique-kg-llm/filter_supporting_paragraphs.py
      hash: md5
      md5: 65b4b57754cc919add1f2057ba9e3224
      size: 522
    outs:
    - path: data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      hash: md5
      md5: 7229e21893c3c22e48db5431dcbbe795
      size: 48748
  decompose_question:
    cmd: python pipelines/musique-kg-llm/decompose_question.py --dataset-file data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      --out data/generated/musique-kg-llm/train-dataset-question-decomposition.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train-dataset-supporting.jsonl
      hash: md5
      md5: 7229e21893c3c22e48db5431dcbbe795
      size: 48748
    - path: pipelines/musique-kg-llm/decompose_question.py
      hash: md5
      md5: f7ac90a566c3bad266262a8c3d2f11ba
      size: 1030
    outs:
    - path: data/generated/musique-kg-llm/train-dataset-question-decomposition.jsonl
      hash: md5
      md5: 7ba06760800b1e5b979563a568c7d7c6
      size: 2581
  decompose_questions:
    cmd: python pipelines/musique-kg-llm/decompose_questions.py --dataset-file data/generated/musique-kg-llm/train/dataset.jsonl
      --out data/generated/musique-kg-llm/train/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: c0820ab95135996039db243bfb9fd53f
      size: 349905
    - path: pipelines/musique-kg-llm/decompose_questions.py
      hash: md5
      md5: 2f07273e75a8a4477516738d8acc398b
      size: 875
    outs:
    - path: data/generated/musique-kg-llm/train/question-decomposition.jsonl
      hash: md5
      md5: 4504c20f47fce6df4d34e0e53b42178d
      size: 14286
  construct_knowledge_graphs:
    cmd: python pipelines/musique-kg-llm/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-kg-llm/train/dataset.jsonl --llm-config-file data/raw/musique-kg-llm/train/jerx-llm-configs/llama3-base-offline.json
      --out data/generated/musique-kg-llm/train/knowledge-graphs/
    deps:
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: c0820ab95135996039db243bfb9fd53f
      size: 349905
    - path: data/raw/musique-kg-llm/train/jerx-llm-configs/llama3-base-offline.json
      hash: md5
      md5: dc97bc475f0e9441ca4ef4b68c0285d1
      size: 186
    - path: pipelines/musique-kg-llm/construct_knowledge_graphs.py
      hash: md5
      md5: 5f7d7d6da7c90a42e3f7bba52092c336
      size: 5596
    outs:
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 2d871b71dc048c4e6802a70bbad44dad
      size: 23
  answer_questions:
    cmd: python pipelines/musique-kg-llm/answer_questions.py --dataset-file data/generated/musique-kg-llm/train/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-kg-llm/train/knowledge-graphs/  --out
      data/generated/musique-kg-llm/train/answers.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 2d871b71dc048c4e6802a70bbad44dad
      size: 23
    - path: data/generated/musique-kg-llm/train/question-decomposition.jsonl
      hash: md5
      md5: 4504c20f47fce6df4d34e0e53b42178d
      size: 14286
    - path: pipelines/musique-kg-llm/answer_questions.py
      hash: md5
      md5: d5af335310a25b4b8b36e8327428d747
      size: 4539
    outs:
    - path: data/generated/musique-kg-llm/train/answers.jsonl
      hash: md5
      md5: 5e95d105ba2636ff42fa160276db5417
      size: 17454
  evaluate_answers:
    cmd: python pipelines/musique-kg-llm/evaluate_answers.py --dataset-file data/generated/musique-kg-llm/train/dataset.jsonl
      --answers-file data/generated/musique-kg-llm/train/answers.jsonl --out data/generated/musique-kg-llm/train/answer-eval/
    deps:
    - path: data/generated/musique-kg-llm/train/answers.jsonl
      hash: md5
      md5: 5e95d105ba2636ff42fa160276db5417
      size: 17454
    - path: data/generated/musique-kg-llm/train/dataset.jsonl
      hash: md5
      md5: c0820ab95135996039db243bfb9fd53f
      size: 349905
    - path: pipelines/musique-kg-llm/evaluate_answers.py
      hash: md5
      md5: 84bbc4567b900e8702710380d36bb4a2
      size: 2056
    outs:
    - path: data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl
      hash: md5
      md5: 10b839abbdc45a702ddfe45d0f826a7d
      size: 11876
    - path: data/generated/musique-kg-llm/train/answer-eval/scores.json
      hash: md5
      md5: edb2b7f85e711eb35a0e4716e74de4dd
      size: 104
  prepare_erx_reward_dataset:
    cmd: python pipelines/musique-kg-llm/prepare_erx_reward_dataset.py --knowledge-graph-directory
      data/generated/musique-kg-llm/train/knowledge-graphs/ --answer-comparisons-file
      data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl --out data/generated/musique-kg-llm/train/erx-reward-dataset.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl
      hash: md5
      md5: 4537d67c9be85fb39e3645cf7c56c3e9
      size: 22575
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/
      hash: md5
      md5: c5d221c379d51b620e6998e3ff523d49.dir
      size: 1584285857
      nfiles: 1501
    - path: pipelines/musique-kg-llm/prepare_erx_reward_dataset.py
      hash: md5
      md5: 2610d7cb5c79f04ac852d3332994e77d
      size: 1842
    outs:
    - path: data/generated/musique-kg-llm/train/erx-reward-dataset.jsonl
      hash: md5
      md5: 001ecaf129251994763297f83319c5dc
      size: 1348151
  prepare_jerx_reward_dataset:
    cmd: python pipelines/musique-kg-llm/prepare_jerx_reward_dataset.py --knowledge-graph-directory
      data/generated/musique-kg-llm/train/knowledge-graphs/ --answer-comparisons-file
      data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl --out data/generated/musique-kg-llm/train/jerx-reward-dataset.jsonl
    deps:
    - path: data/generated/musique-kg-llm/train/answer-eval/comparisons.jsonl
      hash: md5
      md5: 21a1a0da8a2204cfc67fa5132d999761
      size: 14109
    - path: data/generated/musique-kg-llm/train/knowledge-graphs/
      hash: md5
      md5: f480f4b3e8bb70368c9740aec4def1aa.dir
      size: 3116727602
      nfiles: 2771
    - path: pipelines/musique-kg-llm/prepare_jerx_reward_dataset.py
      hash: md5
      md5: 83bdfb0bf19fbc50d6bb3b78f6b1fa1b
      size: 2788
    outs:
    - path: data/generated/musique-kg-llm/train/jerx-reward-dataset.jsonl
      hash: md5
      md5: 9c8718f9c6c8438764b6e2719c20deab
      size: 92631
  publish_jerx_reward_modelling_datasets:
    cmd: python pipelines/musique-kg-llm/publish_jerx_reward_modelling_datasets.py
      --reward-dataset-path data/generated/musique-kg-llm/train/jerx-reward-dataset.jsonl
      --out data/generated/musique-kg-llm/train/jerx-reward-datasets-info.txt
    deps:
    - path: data/generated/musique-kg-llm/train/jerx-reward-dataset.jsonl
      hash: md5
      md5: 9c8718f9c6c8438764b6e2719c20deab
      size: 92631
    - path: pipelines/musique-kg-llm/publish_jerx_reward_modelling_datasets.py
      hash: md5
      md5: 810072795120d9c5e80a403d9498dbf1
      size: 2539
    outs:
    - path: data/generated/musique-kg-llm/train/jerx-reward-datasets-info.txt
      hash: md5
      md5: a02973c41a3d087cb502e6f862554821
      size: 169
