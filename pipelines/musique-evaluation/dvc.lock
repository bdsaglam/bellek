schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-evaluation/create_mhqa_dataset.py --config-file
      data/raw/musique-evaluation/dataset-config.json --out data/generated/musique-evaluation/dataset-full.jsonl
    deps:
    - path: data/raw/musique-evaluation/dataset-config.json
      hash: md5
      md5: 41cce409e518935d2c47140e2f94cd9e
      size: 77
    - path: pipelines/musique-evaluation/create_mhqa_dataset.py
      hash: md5
      md5: 5f2bec09cef4f9b9cb9ce44aa5ae28cd
      size: 2066
    outs:
    - path: data/generated/musique-evaluation/dataset-full.jsonl
      hash: md5
      md5: f570e09a7590b3de019babcd1bc92498
      size: 14933699
  decompose_questions:
    cmd: python pipelines/musique-common/decompose_questions.py --dataset-file data/generated/musique-evaluation/dataset.jsonl
      --out data/generated/musique-evaluation/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 8f3b5d4358407a0b830dedd987190efe
      size: 843920
    - path: pipelines/musique-common/decompose_questions.py
      hash: md5
      md5: 4ededc666a2572a92aa401a140578c50
      size: 1546
    outs:
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: ab704e30bfe7f9852a8ec271e54ef8cd
      size: 40040
  construct_knowledge_graphs:
    cmd: python pipelines/musique-common/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-evaluation/dataset.jsonl --llm-config-file data/raw/musique-evaluation/jerx-llm-configs/llama3.json
      --out data/generated/musique-evaluation/knowledge-graphs/ --include-non-supporting
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 8f3b5d4358407a0b830dedd987190efe
      size: 843920
    - path: data/raw/musique-evaluation/jerx-llm-configs/llama3.json
      hash: md5
      md5: 59e6493d544b688c22b4aa9d2cee06ce
      size: 123
    - path: pipelines/musique-common/construct_knowledge_graphs.py
      hash: md5
      md5: 261012113cfedf215ca90a7fd2899b3f
      size: 7580
    outs:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: abde58ef743a13102bb5a24a3ae2cd54
      size: 26
  answer_questions:
    cmd: python pipelines/musique-common/answer_questions.py --dataset-file data/generated/musique-evaluation/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-evaluation/knowledge-graphs/  --out
      data/generated/musique-evaluation/question-answering
    deps:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: abde58ef743a13102bb5a24a3ae2cd54
      size: 26
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: ab704e30bfe7f9852a8ec271e54ef8cd
      size: 40040
    - path: pipelines/musique-common/answer_questions.py
      hash: md5
      md5: 42594db703d3c24445f988d4b8ef3659
      size: 6152
    outs:
    - path: data/generated/musique-evaluation/question-answering/timestamp.txt
      hash: md5
      md5: 4e36f6fd3eccbf43bcc769f751b20fad
      size: 26
  evaluate_answers:
    cmd: python pipelines/musique-common/evaluate_answers.py --dataset-file data/generated/musique-evaluation/dataset.jsonl
      --answers-dir data/generated/musique-evaluation/question-answering/ --out data/generated/musique-evaluation/answer-eval/
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 8f3b5d4358407a0b830dedd987190efe
      size: 843920
    - path: data/generated/musique-evaluation/question-answering/timestamp.txt
      hash: md5
      md5: 4e36f6fd3eccbf43bcc769f751b20fad
      size: 26
    - path: pipelines/musique-common/evaluate_answers.py
      hash: md5
      md5: 2d030ec456fd08a0dd9e63fdb05fb754
      size: 1509
    outs:
    - path: data/generated/musique-evaluation/answer-eval/comparisons.jsonl
      hash: md5
      md5: 9bfd56a2e7c120a4986b7f6dbb223ed9
      size: 851815
    - path: data/generated/musique-evaluation/answer-eval/scores.json
      hash: md5
      md5: 2f9a4047ba25a8967b99a3a61e72082c
      size: 76
  create_mini_dataset:
    cmd: python pipelines/musique-evaluation/create_mini_dataset.py data/generated/musique-common/base-dataset-validation.jsonl
      --out data/generated/musique-evaluation/dataset.jsonl
    deps:
    - path: data/generated/musique-common/base-dataset-validation.jsonl
      hash: md5
      md5: a2f049d70d39f2fb3758df65fb316c83
      size: 14982567
    - path: pipelines/musique-evaluation/create_mini_dataset.py
      hash: md5
      md5: 3fd9ea18a974929836692fa14a1e9a89
      size: 474
    outs:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 8f3b5d4358407a0b830dedd987190efe
      size: 843920
