schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-evaluation/create_mhqa_dataset.py --config-file
      data/raw/musique-evaluation/dataset-config.json --out data/generated/musique-evaluation/dataset-full.jsonl
    deps:
    - path: data/raw/musique-evaluation/dataset-config.json
      hash: md5
      md5: 41cce409e518935d2c47140e2f94cd9e
      size: 77
    - path: pipelines/musique-evaluation/create_mhqa_dataset.py
      hash: md5
      md5: 338e31eccd6bed8968d847eee589dc5a
      size: 2545
    outs:
    - path: data/generated/musique-evaluation/dataset-full.jsonl
      hash: md5
      md5: 329d38e3231a97f3dac6d0fbd14fcf81
      size: 14933699
  decompose_questions:
    cmd: python pipelines/musique-evaluation/decompose_questions.py --dataset-file
      data/generated/musique-evaluation/dataset.jsonl --out data/generated/musique-evaluation/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: c4a8a0582fd0f5f436b556503d889d5f
      size: 14908982
    - path: pipelines/musique-evaluation/decompose_questions.py
      hash: md5
      md5: 2f07273e75a8a4477516738d8acc398b
      size: 875
    outs:
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: 4132d63468bdeca64d4411c3ceb9bbfa
      size: 353039
  construct_knowledge_graphs:
    cmd: python pipelines/musique-evaluation/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-evaluation/dataset.jsonl --llm-config-file data/raw/musique-evaluation/jerx-llm-configs/llama3-sft-offline.json
      --out data/generated/musique-evaluation/knowledge-graphs/
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: da186a12dee9ca8408c3bf9ebb8cc9aa
      size: 1678753
    - path: data/raw/musique-evaluation/jerx-llm-configs/llama3-sft-offline.json
      hash: md5
      md5: 0edc5206f015725c59b8603e0a60427f
      size: 190
    - path: pipelines/musique-evaluation/construct_knowledge_graphs.py
      hash: md5
      md5: 6912a06627eec241073ac913c9d0292b
      size: 5829
    outs:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: e0a2114db4f8d5a8b2c0e97e90ad78a6
      size: 23
  answer_questions:
    cmd: python pipelines/musique-evaluation/answer_questions.py --dataset-file data/generated/musique-evaluation/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-evaluation/knowledge-graphs/  --out
      data/generated/musique-evaluation/answers.jsonl --ignore-errors
    deps:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: e0a2114db4f8d5a8b2c0e97e90ad78a6
      size: 23
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: 4132d63468bdeca64d4411c3ceb9bbfa
      size: 353039
    - path: pipelines/musique-evaluation/answer_questions.py
      hash: md5
      md5: e73f13344c5e40b9b6c725c106add01c
      size: 4910
    outs:
    - path: data/generated/musique-evaluation/answers.jsonl
      hash: md5
      md5: 00a40337e4c73ddecc3cacb3067b6181
      size: 64824
  evaluate_answers:
    cmd: python pipelines/musique-evaluation/evaluate_answers.py --dataset-file data/generated/musique-evaluation/dataset.jsonl
      --answers-file data/generated/musique-evaluation/answers.jsonl --out data/generated/musique-evaluation/answer-eval/
    deps:
    - path: data/generated/musique-evaluation/answers.jsonl
      hash: md5
      md5: 00a40337e4c73ddecc3cacb3067b6181
      size: 64824
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 3da06ce04ecefec48d33bc3f8362b0bb
      size: 1682892
    - path: pipelines/musique-evaluation/evaluate_answers.py
      hash: md5
      md5: 8c56f8a2cbde0759bde67c790a4dbe9b
      size: 1135
    outs:
    - path: data/generated/musique-evaluation/answer-eval/comparisons.jsonl
      hash: md5
      md5: 0195441edf2bcb79a5938d81ec614624
      size: 1698402
    - path: data/generated/musique-evaluation/answer-eval/scores.json
      hash: md5
      md5: ae2caabf97fdee370e28b79ab945a6c2
      size: 76
  create_mini_dataset:
    cmd: head -n 200 data/generated/musique-evaluation/dataset-full.jsonl > data/generated/musique-evaluation/dataset.jsonl
    deps:
    - path: data/generated/musique-evaluation/dataset-full.jsonl
      hash: md5
      md5: 329d38e3231a97f3dac6d0fbd14fcf81
      size: 14933699
    outs:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: 3da06ce04ecefec48d33bc3f8362b0bb
      size: 1682892
