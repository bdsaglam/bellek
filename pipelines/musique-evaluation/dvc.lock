schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-evaluation/create_mhqa_dataset.py --config-file
      data/raw/musique-evaluation/dataset-config.json --out data/generated/musique-evaluation/dataset-full.jsonl
    deps:
    - path: data/raw/musique-evaluation/dataset-config.json
      hash: md5
      md5: 41cce409e518935d2c47140e2f94cd9e
      size: 77
    - path: pipelines/musique-evaluation/create_mhqa_dataset.py
      hash: md5
      md5: 482c83e1862b591ed9becc9983bbed12
      size: 1886
    outs:
    - path: data/generated/musique-evaluation/dataset-full.jsonl
      hash: md5
      md5: e5a3b77a693f450f09ddcbda0269760b
      size: 14933699
  decompose_questions:
    cmd: python pipelines/musique-evaluation/decompose_questions.py --dataset-file
      data/generated/musique-evaluation/dataset.jsonl --out data/generated/musique-evaluation/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: ebe12e4c3cb6ab966831930f731943cd
      size: 1682892
    - path: pipelines/musique-evaluation/decompose_questions.py
      hash: md5
      md5: 2f07273e75a8a4477516738d8acc398b
      size: 875
    outs:
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: f312809bcdb76f32d5374ad1628eab2d
      size: 53031
  construct_knowledge_graphs:
    cmd: python pipelines/musique-evaluation/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-evaluation/dataset.jsonl --llm-config-file data/raw/musique-evaluation/jerx-llm-configs/llama3-sft-offline.json
      --out data/generated/musique-evaluation/knowledge-graphs/
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: ebe12e4c3cb6ab966831930f731943cd
      size: 1682892
    - path: data/raw/musique-evaluation/jerx-llm-configs/llama3-sft-offline.json
      hash: md5
      md5: 0edc5206f015725c59b8603e0a60427f
      size: 190
    - path: pipelines/musique-evaluation/construct_knowledge_graphs.py
      hash: md5
      md5: 48bb7825ae29da2c4c4c26e45af0f727
      size: 5815
    outs:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: fb59d7a0b06758a0e48465b9756f53b5
      size: 23
  answer_questions:
    cmd: python pipelines/musique-evaluation/answer_questions.py --dataset-file data/generated/musique-evaluation/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-evaluation/knowledge-graphs/  --out
      data/generated/musique-evaluation/question-answering --resume
    deps:
    - path: data/generated/musique-evaluation/knowledge-graphs/timestamp.txt
      hash: md5
      md5: fb59d7a0b06758a0e48465b9756f53b5
      size: 23
    - path: data/generated/musique-evaluation/question-decomposition.jsonl
      hash: md5
      md5: f312809bcdb76f32d5374ad1628eab2d
      size: 53031
    - path: pipelines/musique-evaluation/answer_questions.py
      hash: md5
      md5: 365c9526cec2feaab0f45b2e867f73b2
      size: 5453
    outs:
    - path: data/generated/musique-evaluation/question-answering/timestamp.txt
      hash: md5
      md5: 9292d95509ee6e9e1fdbc2990983602e
      size: 26
  evaluate_answers:
    cmd: python pipelines/musique-evaluation/evaluate_answers.py --dataset-file data/generated/musique-evaluation/dataset.jsonl
      --answers-dir data/generated/musique-evaluation/question-answering/ --out data/generated/musique-evaluation/answer-eval/
    deps:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: ebe12e4c3cb6ab966831930f731943cd
      size: 1682892
    - path: data/generated/musique-evaluation/question-answering/
      hash: md5
      md5: 7421ff35269f1ec87e7b30820fa91b58.dir
      size: 2429609
      nfiles: 401
    - path: pipelines/musique-evaluation/evaluate_answers.py
      hash: md5
      md5: 2d030ec456fd08a0dd9e63fdb05fb754
      size: 1509
    outs:
    - path: data/generated/musique-evaluation/answer-eval/comparisons.jsonl
      hash: md5
      md5: bc9671edbe1769ce094d78bb64698cb0
      size: 1698691
    - path: data/generated/musique-evaluation/answer-eval/scores.json
      hash: md5
      md5: 4616e8736c206322e5d257d034aa5345
      size: 77
  create_mini_dataset:
    cmd: head -n 200 data/generated/musique-evaluation/dataset-full.jsonl > data/generated/musique-evaluation/dataset.jsonl
    deps:
    - path: data/generated/musique-evaluation/dataset-full.jsonl
      hash: md5
      md5: 68e4aec46196b214ae1f0af09d7ea1ff
      size: 14933699
    outs:
    - path: data/generated/musique-evaluation/dataset.jsonl
      hash: md5
      md5: ebe12e4c3cb6ab966831930f731943cd
      size: 1682892
