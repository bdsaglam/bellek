schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-training/create_mhqa_dataset.py --config-file data/raw/musique-training/dataset-config.json
      --out data/generated/musique-training/dataset-full.jsonl
    deps:
    - path: data/raw/musique-training/dataset-config.json
      hash: md5
      md5: 07abe9fcbc403832c8318c4c7009c33b
      size: 72
    - path: pipelines/musique-training/create_mhqa_dataset.py
      hash: md5
      md5: 5f2bec09cef4f9b9cb9ce44aa5ae28cd
      size: 2066
    outs:
    - path: data/generated/musique-training/dataset-full.jsonl
      hash: md5
      md5: 6e28b2ffda29b98758f2f3ba0d5814f4
      size: 167494155
  create_mini_dataset:
    cmd: head -n 200 data/generated/musique-common/base-dataset-train.jsonl > data/generated/musique-training/dataset.jsonl
    deps:
    - path: data/generated/musique-common/base-dataset-train.jsonl
      hash: md5
      md5: 19f134f113563558541de1b9af25881d
      size: 167998718
    outs:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e25eb5a59ec6fd456d6ff0c81e7e9eaf
      size: 1373409
  construct_knowledge_graphs:
    cmd: python pipelines/musique-common/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-training/dataset.jsonl --llm-config-file data/raw/musique-training/jerx-llm-configs/llama3.json
      --out data/generated/musique-training/knowledge-graphs/ --resume
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e25eb5a59ec6fd456d6ff0c81e7e9eaf
      size: 1373409
    - path: data/raw/musique-training/jerx-llm-configs/llama3.json
      hash: md5
      md5: 7441d506dc706902e28dfe410485aca5
      size: 223
    - path: pipelines/musique-common/construct_knowledge_graphs.py
      hash: md5
      md5: d667f79e7870b5823f4af450935e7fcf
      size: 6343
    outs:
    - path: data/generated/musique-training/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 87422a53c72b4c0cb00f9228f3a39dff
      size: 23
  answer_questions:
    cmd: python pipelines/musique-training/answer_questions.py --dataset-file data/generated/musique-training/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-training/knowledge-graphs/  --out
      data/generated/musique-training/question-answering
    deps:
    - path: data/generated/musique-training/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 87422a53c72b4c0cb00f9228f3a39dff
      size: 23
    - path: data/generated/musique-training/question-decomposition.jsonl
      hash: md5
      md5: 6f7a09bea0d2078e265adfe65b8fc49e
      size: 52451
    - path: pipelines/musique-training/answer_questions.py
      hash: md5
      md5: f88e73af4bc777962430e38a6cec9810
      size: 5584
    outs:
    - path: data/generated/musique-training/question-answering/timestamp.txt
      hash: md5
      md5: 7d237274ed3657baa26ee1e98f541e3c
      size: 26
  evaluate_answers:
    cmd: python pipelines/musique-training/evaluate_answers.py --dataset-file data/generated/musique-training/dataset.jsonl
      --answers-dir data/generated/musique-training/question-answering/ --out data/generated/musique-training/answer-eval/
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e25eb5a59ec6fd456d6ff0c81e7e9eaf
      size: 1373409
    - path: data/generated/musique-training/question-answering/
      hash: md5
      md5: 9a220037efaa1909ec760868e41a16eb.dir
      size: 2348868
      nfiles: 387
    - path: pipelines/musique-training/evaluate_answers.py
      hash: md5
      md5: 2d030ec456fd08a0dd9e63fdb05fb754
      size: 1509
    outs:
    - path: data/generated/musique-training/answer-eval/comparisons.jsonl
      hash: md5
      md5: cb33972b68e8b072031758d8ffe0e76b
      size: 1344031
    - path: data/generated/musique-training/answer-eval/scores.json
      hash: md5
      md5: 741d7f0d49500f5a515db166c95aec3d
      size: 105
  decompose_questions:
    cmd: python pipelines/musique-common/decompose_questions.py --dataset-file data/generated/musique-training/dataset.jsonl
      --out data/generated/musique-training/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e25eb5a59ec6fd456d6ff0c81e7e9eaf
      size: 1373409
    - path: pipelines/musique-common/decompose_questions.py
      hash: md5
      md5: a4b799dce9580d76d5f3bc1fd2e8b1ed
      size: 1539
    outs:
    - path: data/generated/musique-training/question-decomposition.jsonl
      hash: md5
      md5: e7b57ad58b23ffd04a0ac964755d1ca2
      size: 52425
