schema: '2.0'
stages:
  create_mhqa_dataset:
    cmd: python pipelines/musique-training/create_mhqa_dataset.py --config-file data/raw/musique-training/dataset-config.json
      --out data/generated/musique-training/dataset-full.jsonl
    deps:
    - path: data/raw/musique-training/dataset-config.json
      hash: md5
      md5: 07abe9fcbc403832c8318c4c7009c33b
      size: 72
    - path: pipelines/musique-training/create_mhqa_dataset.py
      hash: md5
      md5: 5f2bec09cef4f9b9cb9ce44aa5ae28cd
      size: 2066
    outs:
    - path: data/generated/musique-training/dataset-full.jsonl
      hash: md5
      md5: 6e28b2ffda29b98758f2f3ba0d5814f4
      size: 167494155
  create_mini_dataset:
    cmd: head -n 1000 data/generated/musique-common/base-dataset-train.jsonl > data/generated/musique-training/dataset.jsonl
    deps:
    - path: data/generated/musique-common/base-dataset-train.jsonl
      hash: md5
      md5: 19f134f113563558541de1b9af25881d
      size: 167998718
    outs:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e1528c9596596c8c80db2f62af38daf0
      size: 7977782
  construct_knowledge_graphs:
    cmd: python pipelines/musique-common/construct_knowledge_graphs.py --dataset-file
      data/generated/musique-training/dataset.jsonl --llm-config-file data/raw/musique-training/jerx-llm-configs/llama3.json
      --out data/generated/musique-training/knowledge-graphs/
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e1528c9596596c8c80db2f62af38daf0
      size: 7977782
    - path: data/raw/musique-training/jerx-llm-configs/llama3.json
      hash: md5
      md5: 73d5d559f6f015c9ab9fc78e19980eb0
      size: 229
    - path: pipelines/musique-common/construct_knowledge_graphs.py
      hash: md5
      md5: b4631828af168953e81783916116adfb
      size: 7568
    outs:
    - path: data/generated/musique-training/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 48cb85e9d367cf459000cdd400050a54
      size: 26
  answer_questions:
    cmd: python pipelines/musique-common/answer_questions.py --dataset-file data/generated/musique-training/question-decomposition.jsonl
      --knowledge-graph-directory data/generated/musique-training/knowledge-graphs/  --out
      data/generated/musique-training/question-answering
    deps:
    - path: data/generated/musique-training/knowledge-graphs/timestamp.txt
      hash: md5
      md5: 03f6850395af4f948b204527e290bdd3
      size: 26
    - path: data/generated/musique-training/question-decomposition.jsonl
      hash: md5
      md5: 11d2ea8c8e59ed31facc68314822b130
      size: 399820
    - path: pipelines/musique-common/answer_questions.py
      hash: md5
      md5: a5d1e380433d5d353b607b0627a3b13e
      size: 6142
    outs:
    - path: data/generated/musique-training/question-answering/timestamp.txt
      hash: md5
      md5: 49fa0bb9e4d75fbe15bc57f41b3b06a8
      size: 26
  evaluate_answers:
    cmd: python pipelines/musique-common/evaluate_answers.py --dataset-file data/generated/musique-training/dataset.jsonl
      --answers-dir data/generated/musique-training/question-answering/ --out data/generated/musique-training/answer-eval/
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e1528c9596596c8c80db2f62af38daf0
      size: 7977782
    - path: data/generated/musique-training/question-answering/
      hash: md5
      md5: 99fc28f143eb0d01b9c2307d05c3b2d9.dir
      size: 15584480
      nfiles: 1985
    - path: pipelines/musique-common/evaluate_answers.py
      hash: md5
      md5: 2d030ec456fd08a0dd9e63fdb05fb754
      size: 1509
    outs:
    - path: data/generated/musique-training/answer-eval/comparisons.jsonl
      hash: md5
      md5: dc68aaa3cd7bd3f2ebcdf774e3d6980a
      size: 8000458
    - path: data/generated/musique-training/answer-eval/scores.json
      hash: md5
      md5: 1385507e023cf7fae6d3969646b83930
      size: 104
  decompose_questions:
    cmd: python pipelines/musique-common/decompose_questions.py --dataset-file data/generated/musique-training/dataset.jsonl
      --out data/generated/musique-training/question-decomposition.jsonl
    deps:
    - path: data/generated/musique-training/dataset.jsonl
      hash: md5
      md5: e1528c9596596c8c80db2f62af38daf0
      size: 7977782
    - path: pipelines/musique-common/decompose_questions.py
      hash: md5
      md5: 688171404a1577e2faa2134cf3deb8a7
      size: 1389
    outs:
    - path: data/generated/musique-training/question-decomposition.jsonl
      hash: md5
      md5: 11d2ea8c8e59ed31facc68314822b130
      size: 399820
