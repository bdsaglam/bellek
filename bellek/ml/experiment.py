# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/ml.experiment.ipynb.

# %% auto 0
__all__ = ['make_experiment_dir', 'prepare_config', 'merge_config_with_sweep_config']

# %% ../../nbs/ml.experiment.ipynb 3
from pathlib import Path
import torch
from ..utils import NestedDict, flatten_dict

# %% ../../nbs/ml.experiment.ipynb 4
def make_experiment_dir(root="./experiments", name=None):
    if name is None:
        from bellek.utils import generate_time_id
        name = generate_time_id()
    experiment_dir = Path(root) / name
    experiment_dir.mkdir(parents=True, exist_ok=True)
    return experiment_dir

# %% ../../nbs/ml.experiment.ipynb 5
def prepare_config(config):
    if "device" not in config:
        config["device"] = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    
    for k, v in config.flat().items():
        if isinstance(k, str) and k.endswith("path"):
            config.set(k, str(Path(v).resolve()))
    return config

# %% ../../nbs/ml.experiment.ipynb 6
def merge_config_with_sweep_config(base_config, sweep_config, sep='.'):
    return NestedDict.from_flat_dict({**flatten_dict(base_config, sep=sep), **flatten_dict(sweep_config, sep=sep)}, sep=sep)
